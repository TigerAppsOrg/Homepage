---
import { Image } from "astro:assets";
import GithubIcon from "../../../assets/icons/github-mark.svg";
import type { AppProps } from "../../../utils/types";
import { categoryColors } from "../../../utils/apps";
import PersonList from "./PersonList.astro";

interface Props extends AppProps {
    delay?: number;
}

const {
    title,
    description,
    webLink,
    repoLink,
    screenshot,
    alt,
    category,
    contributors,
    additionalContributors,
    delay = 0
} = Astro.props;

const colors = categoryColors[category] || categoryColors["Campus Life"];
---

<article
    class="app-card group bg-white rounded-xl border-2 border-transparent hover:border-current shadow-pop hover:shadow-pop-hover transition-all duration-300 overflow-hidden animate-fade-in-up"
    style={`animation-delay: ${delay}s; --tw-text-opacity: 0.15; color: ${colors.accent}`}>
    <div class="flex gap-4 p-4">
        <!-- Left column: Thumbnail + Actions -->
        <div class="shrink-0 flex flex-col gap-2">
            <a
                href={webLink}
                target="_blank"
                class="block w-24 h-24 sm:w-32 sm:h-24 rounded-lg overflow-hidden bg-light">
                <Image
                    src={screenshot}
                    {alt}
                    class="w-full h-full object-cover"
                />
            </a>
            <!-- Actions under image -->
            <div class="flex items-center gap-2">
                <a
                    href={webLink}
                    target="_blank"
                    class="inline-flex items-center gap-1 text-xs font-semibold px-2.5 py-1 rounded-full transition-all duration-200"
                    style={`background-color: ${colors.accent}20; color: ${colors.accent}`}>
                    <svg
                        class="w-3 h-3"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2.5">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"
                        ></path>
                    </svg>
                    Open
                </a>
                {
                    repoLink && (
                        <a
                            href={repoLink}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-1 text-xs font-medium text-gray hover:text-charcoal px-1.5 py-1 rounded-full hover:bg-light transition-colors"
                            title="View source code">
                            <Image
                                height={12}
                                width={12}
                                src={GithubIcon}
                                alt="GitHub"
                            />
                            Code
                        </a>
                    )
                }
            </div>
        </div>

        <!-- Right column: Content -->
        <div class="flex-1 min-w-0">
            <a href={webLink} target="_blank" class="block">
                <h4
                    class="font-bold text-charcoal group-hover:text-pixar-blue transition-colors duration-200 truncate"
                    style={`--hover-color: ${colors.accent}`}>
                    {title}
                </h4>
            </a>

            <p class="text-sm text-gray-dark mt-1">
                {description}
            </p>

            <div class="mt-2 text-xs text-gray">
                <PersonList startMsg="By" personList={contributors} />
                {
                    additionalContributors &&
                        additionalContributors.length > 0 &&
                        additionalContributors.map(section => (
                            <span class="ml-1">
                                <PersonList
                                    startMsg={section.startMsg}
                                    personList={section.contributors}
                                />
                            </span>
                        ))
                }
            </div>
        </div>
    </div>
</article>
